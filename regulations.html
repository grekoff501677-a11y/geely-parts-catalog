<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¢–û | Damu Auto</title>
<meta name="theme-color" content="#aa8643">
<link rel="icon" type="image/png" href="https://res.cloudinary.com/djjcxxgfm/image/upload/f_auto,q_auto,w_64/v1757929669/%D0%BE%D1%80%D0%B8%D0%B3%D0%B8%D0%BD%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9_%D1%82%D0%BE%D0%BF%D0%BB%D0%B8%D0%B2%D0%BD%D1%8B%D0%B9_%D1%84%D0%B8%D0%BB%D1%8C%D1%82%D1%80_geely_coolray_okavango_azkarra_%D0%BA%D0%BE%D0%BF%D0%B8%D1%8F_%D0%BA%D0%BE%D0%BF%D0%B8%D1%8F_%D0%BA%D0%BE%D0%BF%D0%B8%D1%8F_9_avfuii.png">

<style>
  :root{ --bg:#0a1c2b; --card:#0f1d2a; --muted:#9fb2c3; --text:#e9f0f7; --brand:#aa8643; --border:#1e3040; --chip:#122233; --chip-active:#16283a; --table-head:#112131; }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui, -apple-system, sans-serif; padding-bottom: 50px;}
  
  header{background:rgba(10,28,43,.95);backdrop-filter:blur(10px);border-bottom:1px solid var(--border);padding:16px 0;position:sticky;top:0;z-index:100}
  .wrap{max-width:1100px;margin:0 auto;padding:0 18px}
  .head-row{display:flex;align-items:center;justify-content:space-between}
  .back-link{color:var(--brand);text-decoration:none;font-weight:600;font-size:14px}
  h3{font-size: 18px;}
  
  .controls{margin-top:15px; overflow-x: auto; padding-bottom: 5px; scrollbar-width: none;}
  .controls::-webkit-scrollbar { display: none; }
  .chips{display:flex;gap:10px;}
  .chip{padding:8px 16px;border-radius:20px;border:1px solid var(--border);background:var(--chip);color:#c3d7eb;cursor:pointer;white-space:nowrap;font-size:14px;transition:0.2s;}
  .chip:hover{border-color:var(--brand);}
  .chip.active{background:var(--brand);color:#fff;border-color:var(--brand);box-shadow: 0 0 10px rgba(170, 134, 67, 0.4);}

  /* –¢–∞–±–ª–∏—Ü–∞ */
  .table-container{margin-top:20px;overflow-x:auto;border-radius:12px;border:1px solid var(--border);background:var(--card); box-shadow: 0 10px 30px rgba(0,0,0,0.3);}
  table{width:100%;border-collapse:collapse;min-width:800px;font-size:13px}
  th, td{padding:12px 10px;text-align:center;border-bottom:1px solid var(--border)}
  th{background:var(--table-head);color:var(--brand);font-weight:600;cursor:pointer;transition:0.2s; position:relative;}
  th:hover:not(:first-child){background:var(--brand);color:#fff;}
  /* –§–∏–∫—Å–∏—Ä—É–µ–º –ø–µ—Ä–≤—ã–π —Å—Ç–æ–ª–±–µ—Ü */
  th:first-child, td:first-child{text-align:left;position:sticky;left:0;background:var(--card);z-index:2;border-right: 1px solid var(--border); min-width: 180px;}
  
  .marker-z{color:#fff;background:var(--brand);border-radius:4px;display:inline-block;width:24px;height:24px;line-height:24px;font-weight:bold;} 
  .marker-i{color:var(--muted);font-size: 12px;}

  /* –ë–ª–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–ö–æ—Ä–∑–∏–Ω–∞ –¢–û) */
  #to-result { display: none; margin-top: 30px; scroll-margin-top: 100px; }
  .result-header { border-left: 4px solid var(--brand); padding-left: 15px; margin-bottom: 20px; }
  .result-header h2 { margin: 0; color: #fff; font-size: 20px;}
  .result-header p { margin: 5px 0 0; color: var(--muted); font-size: 14px;}

  .parts-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 12px; }
  
  .part-card { background: var(--card); border: 1px solid var(--border); border-radius: 10px; padding: 12px; display: flex; gap: 12px; align-items: center; transition: 0.2s; }
  .part-card:hover { border-color: var(--brand); transform: translateY(-2px); }
  .part-img { width: 70px; height: 70px; object-fit: contain; background: #fff; border-radius: 6px; padding: 2px;}
  .part-info { flex: 1; }
  .part-info h4 { margin: 0 0 4px; font-size: 14px; color: #fff; line-height: 1.3;}
  .part-meta { font-size: 12px; color: var(--muted); margin-bottom: 6px; }
  .part-price { color: var(--brand); font-weight: bold; font-size: 15px;}
  .part-btn { display: block; margin-top: 8px; padding: 8px; background: var(--border); color: #fff; text-decoration: none; font-size: 13px; border-radius: 6px; text-align: center; transition:0.2s;}
  .part-btn.active { background: var(--brand); }
  .part-btn:hover { filter: brightness(1.1); }

  .empty-msg { color: var(--muted); font-style: italic; padding: 15px; border: 1px dashed var(--border); border-radius: 8px; text-align: center;}
  
  .legend { display: flex; gap: 15px; margin-top: 10px; font-size: 12px; color: var(--muted); padding: 0 5px;}
  .legend span { display: flex; align-items: center; gap: 5px; }

  /* –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–±–µ–≥–∞ */
  .col-selected { background: rgba(170, 134, 67, 0.15) !important; }
</style>
</head>
<body>

<header>
  <div class="wrap">
    <div class="head-row">
      <h3 style="margin:0">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¢–û</h3>
      <a href="/" class="back-link">‚Üê –í –ö–∞—Ç–∞–ª–æ–≥</a>
    </div>
    <div class="controls">
      <div class="chips" id="modelChips"></div>
    </div>
  </div>
</header>

<main class="wrap">
  <div class="table-container" id="tableWrap"></div>
  
  <div class="legend">
    <span><b class="marker-z">–ó</b> ‚Äî –ó–∞–º–µ–Ω–∞</span>
    <span><b>–ò</b> ‚Äî –û—Å–º–æ—Ç—Ä/–ü—Ä–æ–≤–µ—Ä–∫–∞</span>
  </div>

  <div id="to-result">
    <div class="result-header">
      <h2 id="res-title">–¢–û...</h2>
      <p>–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–∞–ø—á–∞—Å—Ç–∏ –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞:</p>
    </div>
    <div class="parts-grid" id="res-grid"></div>
  </div>
</main>

<script>
// 1. –î–ê–ù–ù–´–ï –†–ï–ì–õ–ê–ú–ï–ù–¢–ê (–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ PDF)
const DATA = {
  monjaro: {
    title: "Geely Monjaro (KX11)",
    rows: [
      { name: "–ú–æ—Ç–æ—Ä–Ω–æ–µ –º–∞—Å–ª–æ", search: ["–º–∞—Å–ª–æ"], vals: ["–ó","–ó","–ó","–ó","–ó","–ó","–ó","–ó","–ó","–ó"] }, // –ö–∞–∂–¥—ã–µ 10
      { name: "–ú–∞—Å–ª—è–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä", search: ["–º–∞—Å–ª—è–Ω—ã–π"], vals: ["–ó","–ó","–ó","–ó","–ó","–ó","–ó","–ó","–ó","–ó"] }, // –ö–∞–∂–¥—ã–µ 10
      { name: "–í–æ–∑–¥—É—à–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä", search: ["–≤–æ–∑–¥—É—à–Ω—ã–π"], vals: ["–ò","–ó","–ò","–ó","–ò","–ó","–ò","–ó","–ò","–ó"] }, // –ö–∞–∂–¥—ã–µ 20
      { name: "–°–∞–ª–æ–Ω–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä", search: ["—Å–∞–ª–æ–Ω–Ω—ã–π"], vals: ["–ò","–ó","–ò","–ó","–ò","–ó","–ò","–ó","–ò","–ó"] }, // –ö–∞–∂–¥—ã–µ 20
      { name: "–¢–æ–ø–ª–∏–≤–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä", search: ["—Ç–æ–ø–ª–∏–≤–Ω—ã–π"], vals: ["-","-","–ó","-","-","–ó","-","-","–ó","-"] }, // 30, 60, 90
      { name: "–°–≤–µ—á–∏ –∑–∞–∂–∏–≥–∞–Ω–∏—è", search: ["—Å–≤–µ—á–∏"], vals: ["-","-","-","–ó","-","-","-","–ó","-","-"] }, // 40, 80
      { name: "–¢–æ—Ä–º–æ–∑–Ω–∞—è –∂–∏–¥–∫–æ—Å—Ç—å", search: ["—Ç–æ—Ä–º–æ–∑–Ω–∞—è"], vals: ["-","-","-","–ó","-","-","-","–ó","-","-"] }, // 40, 80
      { name: "–ê–Ω—Ç–∏—Ñ—Ä–∏–∑ (–û—Ö–ª. –∂–∏–¥–∫.)", search: ["–∞–Ω—Ç–∏—Ñ—Ä–∏–∑", "–æ—Ö–ª–∞–∂–¥–∞—é—â–∞—è"], vals: ["-","-","-","-","-","-","-","-","–ó","-"] }, // 90
      { name: "–†–µ–º–µ–Ω—å –ì–†–ú", search: ["–≥—Ä–º"], vals: ["-","-","-","-","-","-","-","-","-","–ó"] } // 100 (–ï—Å—Ç—å –≤ PDF!)
    ]
  },
  coolray: {
    title: "Geely Coolray (SX11)",
    rows: [
      { name: "–ú–æ—Ç–æ—Ä–Ω–æ–µ –º–∞—Å–ª–æ", search: ["–º–∞—Å–ª–æ"], vals: ["–ó","–ó","–ó","–ó","–ó","–ó","–ó","–ó","–ó","–ó"] },
      { name: "–ú–∞—Å–ª—è–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä", search: ["–º–∞—Å–ª—è–Ω—ã–π"], vals: ["–ó","–ó","–ó","–ó","–ó","–ó","–ó","–ó","–ó","–ó"] },
      { name: "–í–æ–∑–¥—É—à–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä", search: ["–≤–æ–∑–¥—É—à–Ω—ã–π"], vals: ["–ò","–ó","–ò","–ó","–ò","–ó","–ò","–ó","–ò","–ó"] },
      { name: "–°–∞–ª–æ–Ω–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä", search: ["—Å–∞–ª–æ–Ω–Ω—ã–π"], vals: ["–ò","–ó","–ò","–ó","–ò","–ó","–ò","–ó","–ò","–ó"] },
      { name: "–¢–æ–ø–ª–∏–≤–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä", search: ["—Ç–æ–ø–ª–∏–≤–Ω—ã–π"], vals: ["-","-","–ó","-","-","–ó","-","-","–ó","-"] }, // 30, 60, 90
      { name: "–°–≤–µ—á–∏ –∑–∞–∂–∏–≥–∞–Ω–∏—è", search: ["—Å–≤–µ—á–∏"], vals: ["-","-","-","–ó","-","-","-","–ó","-","-"] }, // 40, 80
      { name: "–¢–æ—Ä–º–æ–∑–Ω–∞—è –∂–∏–¥–∫–æ—Å—Ç—å", search: ["—Ç–æ—Ä–º–æ–∑–Ω–∞—è"], vals: ["-","-","-","–ó","-","-","-","–ó","-","-"] }, // 40, 80
      { name: "–ú–∞—Å–ª–æ –≤ —Ä–æ–±–æ—Ç–µ (7DCT)", search: ["dct", "—Ç—Ä–∞–Ω—Å–º–∏—Å—Å–∏–æ–Ω"], vals: ["-","-","-","-","-","-","-","-","–ó","-"] } // 90
      // –¶–µ–ø—å –ì–†–ú - –Ω–µ –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç—Å—è
    ]
  },
  okavango: {
    title: "Geely Okavango (VX11)",
    rows: [
      { name: "–ú–æ—Ç–æ—Ä–Ω–æ–µ –º–∞—Å–ª–æ", search: ["–º–∞—Å–ª–æ"], vals: ["–ó","–ó","–ó","–ó","–ó","–ó","–ó","–ó","–ó","–ó"] },
      { name: "–ú–∞—Å–ª—è–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä", search: ["–º–∞—Å–ª—è–Ω—ã–π"], vals: ["–ó","–ó","–ó","–ó","–ó","–ó","–ó","–ó","–ó","–ó"] },
      { name: "–í–æ–∑–¥—É—à–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä", search: ["–≤–æ–∑–¥—É—à–Ω—ã–π"], vals: ["–ò","–ó","–ò","–ó","–ò","–ó","–ò","–ó","–ò","–ó"] },
      { name: "–°–∞–ª–æ–Ω–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä", search: ["—Å–∞–ª–æ–Ω–Ω—ã–π"], vals: ["–ò","–ó","–ò","–ó","–ò","–ó","–ò","–ó","–ò","–ó"] },
      { name: "–¢–æ–ø–ª–∏–≤–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä", search: ["—Ç–æ–ø–ª–∏–≤–Ω—ã–π"], vals: ["-","-","–ó","-","-","–ó","-","-","–ó","-"] }, // 30, 60, 90
      { name: "–°–≤–µ—á–∏ –∑–∞–∂–∏–≥–∞–Ω–∏—è", search: ["—Å–≤–µ—á–∏"], vals: ["-","-","-","–ó","-","-","-","–ó","-","-"] }, // 40, 80
      { name: "–¢–æ—Ä–º–æ–∑–Ω–∞—è –∂–∏–¥–∫–æ—Å—Ç—å", search: ["—Ç–æ—Ä–º–æ–∑–Ω–∞—è"], vals: ["-","-","-","–ó","-","-","-","–ó","-","-"] }, // 40, 80
      { name: "–ú–∞—Å–ª–æ –≤ —Ä–æ–±–æ—Ç–µ (7DCT)", search: ["dct", "—Ç—Ä–∞–Ω—Å–º–∏—Å—Å–∏–æ–Ω"], vals: ["-","-","-","-","-","-","-","-","–ó","-"] }, // 90
      { name: "–†–µ–º–µ–Ω—å –ì–†–ú", search: ["–≥—Ä–º"], vals: ["-","-","-","-","-","-","-","-","-","–ó"] } // 100
    ]
  },
  atlas: {
    title: "Geely Atlas",
    rows: [
      { name: "–ú–æ—Ç–æ—Ä–Ω–æ–µ –º–∞—Å–ª–æ", search: ["–º–∞—Å–ª–æ"], vals: ["–ó","–ó","–ó","–ó","–ó","–ó","–ó","–ó","–ó","–ó"] },
      { name: "–ú–∞—Å–ª—è–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä", search: ["–º–∞—Å–ª—è–Ω—ã–π"], vals: ["–ó","–ó","–ó","–ó","–ó","–ó","–ó","–ó","–ó","–ó"] },
      { name: "–í–æ–∑–¥—É—à–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä", search: ["–≤–æ–∑–¥—É—à–Ω—ã–π"], vals: ["–ò","–ó","–ò","–ó","–ò","–ó","–ò","–ó","–ò","–ó"] },
      { name: "–°–∞–ª–æ–Ω–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä", search: ["—Å–∞–ª–æ–Ω–Ω—ã–π"], vals: ["–ò","–ó","–ò","–ó","–ò","–ó","–ò","–ó","–ò","–ó"] },
      { name: "–°–≤–µ—á–∏ –∑–∞–∂–∏–≥–∞–Ω–∏—è", search: ["—Å–≤–µ—á–∏"], vals: ["-","-","-","–ó","-","-","-","–ó","-","-"] }, // 40, 80
      { name: "–¢–æ—Ä–º–æ–∑–Ω–∞—è –∂–∏–¥–∫–æ—Å—Ç—å", search: ["—Ç–æ—Ä–º–æ–∑–Ω–∞—è"], vals: ["-","-","-","–ó","-","-","-","–ó","-","-"] }, // 40, 80
      { name: "–ê–Ω—Ç–∏—Ñ—Ä–∏–∑", search: ["–∞–Ω—Ç–∏—Ñ—Ä–∏–∑"], vals: ["-","-","-","-","-","-","-","-","–ó","-"] }, // 90
      { name: "–ú–∞—Å–ª–æ –≤ —Ä–æ–±–æ—Ç–µ (7DCT)", search: ["dct", "—Ç—Ä–∞–Ω—Å–º–∏—Å—Å–∏–æ–Ω"], vals: ["-","-","-","-","-","-","-","-","–ó","-"] }, // 90
      { name: "–†–µ–º–µ–Ω—å –ì–†–ú", search: ["–≥—Ä–º"], vals: ["-","-","-","-","-","-","-","-","-","–ó"] } // 100
      // –¢–æ–ø–ª–∏–≤–Ω—ã–π - –Ω–µ –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç—Å—è (–ø–æ PDF)
    ]
  }
};

const MODELS = [
  {id:'monjaro', label:'Monjaro'},
  {id:'coolray', label:'Coolray'},
  {id:'okavango', label:'Okavango'},
  {id:'atlas', label:'Atlas'},
];

let activeModel = 'monjaro';
let productsDB = [];

// === –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø –ö–ê–†–¢–ò–ù–û–ö (–° –≤–∞—à–µ–≥–æ —Å–∞–π—Ç–∞) ===
function cldUrl(url, w){
  try{
    const marker = '/image/upload/';
    const i = url.indexOf(marker);
    if (i === -1) return url;
    const prefix = url.slice(0, i + marker.length);
    const nextSlash = url.indexOf('/', i + marker.length);
    const rest = nextSlash !== -1 ? url.slice(nextSlash + 1) : '';
    // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ñ–æ—Ä–º–∞—Ç auto (webp), –∫–∞—á–µ—Å—Ç–≤–æ auto, —à–∏—Ä–∏–Ω—É w
    return `${prefix}f_auto,q_auto,w_${w}/${rest}`;
  }catch(_){ return url; }
}

const params = new URLSearchParams(window.location.search);
const modelFromUrl = params.get('model');
if(modelFromUrl && DATA[modelFromUrl]) activeModel = modelFromUrl;

init();

function init(){
  renderChips();
  loadProductsAndRender();
}

function setModel(id){
  activeModel = id;
  const url = new URL(window.location);
  url.searchParams.set('model', id);
  window.history.pushState({}, '', url);
  renderChips();
  loadProductsAndRender();
  document.getElementById('to-result').style.display = 'none';
}

function renderChips(){
  document.getElementById('modelChips').innerHTML = MODELS.map(m => 
    `<div class="chip ${m.id === activeModel ? 'active' : ''}" 
          onclick="setModel('${m.id}')">${m.label}</div>`
  ).join('');
}

async function loadProductsAndRender(){
  const tableWrap = document.getElementById('tableWrap');
  tableWrap.innerHTML = '<div style="padding:20px;text-align:center;color:#9fb2c3">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–∞–ª–æ–≥–∞...</div>';
  
  try {
    const resp = await fetch(`./${activeModel}.json`);
    const json = await resp.json();
    productsDB = json.items || [];
    renderTable();
  } catch(e) {
    tableWrap.innerHTML = '<div style="padding:20px;color:red">–û—à–∏–±–∫–∞. –ù–µ –Ω–∞–π–¥–µ–Ω —Ñ–∞–π–ª —Å —Ç–æ–≤–∞—Ä–∞–º–∏.</div>';
  }
}

function renderTable(){
  const data = DATA[activeModel];
  const headers = Array.from({length:10}, (_,i) => (i+1)*10);
  
  let html = `
    <table>
      <thead>
        <tr>
          <th>–£–∑–µ–ª / –ü—Ä–æ–±–µ–≥</th>
          ${headers.map((h, i) => 
            `<th onclick="showTO(${i}, ${h}, this)">
               ${h} —Ç.–∫–º<br><span style="font-size:10px;font-weight:normal;opacity:0.7">–ñ–º–∏</span>
             </th>`
          ).join('')}
        </tr>
      </thead>
      <tbody>
        ${data.rows.map(row => `
          <tr>
            <td>${row.name}</td>
            ${row.vals.map((v, idx) => {
              let content = v;
              if(v === '–ó') content = '<span class="marker-z">–ó</span>';
              if(v === '–ò') content = '<span class="marker-i">–ò</span>';
              return `<td class="col-${idx}">${content}</td>`;
            }).join('')}
          </tr>
        `).join('')}
      </tbody>
    </table>
  `;
  document.getElementById('tableWrap').innerHTML = html;
}

window.showTO = function(colIndex, km, thElement){
  const data = DATA[activeModel];
  const resBlock = document.getElementById('to-result');
  const resGrid = document.getElementById('res-grid');
  
  // –í–∏–∑—É–∞–ª—å–Ω–∞—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –∫–æ–ª–æ–Ω–∫–∏
  document.querySelectorAll('td, th').forEach(el => el.classList.remove('col-selected'));
  thElement.classList.add('col-selected');
  document.querySelectorAll(`.col-${colIndex}`).forEach(el => el.classList.add('col-selected'));

  resBlock.style.display = 'block';
  document.getElementById('res-title').innerText = `–¢–û –Ω–∞ ${km} 000 –∫–º`;
  resGrid.innerHTML = '';

  const needsReplace = data.rows.filter(r => r.vals[colIndex] === '–ó');

  if(needsReplace.length === 0){
    resGrid.innerHTML = '<div class="empty-msg">–ù–∞ —ç—Ç–æ–º –ø—Ä–æ–±–µ–≥–µ —Ç–æ–ª—å–∫–æ –æ—Å–º–æ—Ç—Ä (–ò–Ω—Å–ø–µ–∫—Ü–∏—è). –ó–∞–º–µ–Ω –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.</div>';
    resBlock.scrollIntoView({behavior: "smooth"});
    return;
  }

  needsReplace.forEach(req => {
    // –ö–∞—Ä—Ç–æ—á–∫–∞-–∑–∞–≥–æ–ª–æ–≤–æ–∫ (—á—Ç–æ –º–µ–Ω—è–µ–º)
    const titleCard = document.createElement('div');
    titleCard.style.gridColumn = "1 / -1";
    titleCard.style.marginTop = "10px";
    titleCard.style.borderBottom = "1px solid var(--border)";
    titleCard.style.paddingBottom = "5px";
    titleCard.innerHTML = `<strong style="color:var(--brand)">üõ† ${req.name}</strong>`;
    resGrid.appendChild(titleCard);

    // –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤
    const keywords = req.search || [req.name.toLowerCase()];
    const foundParts = productsDB.filter(p => {
      const pName = p.name.toLowerCase();
      const pDesc = (p.desc || "").toLowerCase();
      // –ò—â–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–≥–æ —Å–ª–æ–≤–∞
      return keywords.some(k => pName.includes(k) || pDesc.includes(k));
    });

    if(foundParts.length > 0){
      foundParts.forEach(p => {
        const optimizedImg = cldUrl(p.img, 200); // –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø –ó–î–ï–°–¨
        
        const card = document.createElement('div');
        card.className = 'part-card';
        card.innerHTML = `
          <img src="${optimizedImg}" class="part-img" alt="${p.name}" loading="lazy">
          <div class="part-info">
            <h4>${p.name}</h4>
            <div class="part-price">${new Intl.NumberFormat('ru-RU').format(p.price)} ‚Ç∏</div>
            <a href="${p.kaspi || '#'}" target="_blank" class="part-btn ${p.kaspi ? 'active' : ''}">
              ${p.kaspi ? '–ö—É–ø–∏—Ç—å –Ω–∞ Kaspi' : '–ù–µ—Ç —Å—Å—ã–ª–∫–∏'}
            </a>
          </div>
        `;
        resGrid.appendChild(card);
      });
    } else {
      const msg = document.createElement('div');
      msg.className = 'empty-msg';
      msg.style.textAlign = 'left';
      msg.innerText = '–¢–æ–≤–∞—Ä –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–∞—Ç–∞–ª–æ–≥.';
      resGrid.appendChild(msg);
    }
  });

  setTimeout(() => resBlock.scrollIntoView({behavior: "smooth"}), 100);
}
</script>

</body>
</html>
