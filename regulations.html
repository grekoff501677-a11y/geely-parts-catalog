<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¢–û | Damu Auto</title>
<meta name="theme-color" content="#aa8643">
<link rel="icon" type="image/png" href="https://res.cloudinary.com/djjcxxgfm/image/upload/f_png,w_32,h_32,c_fill/v1757929669/%D0%BE%D1%80%D0%B8%D0%B3%D0%B8%D0%BD%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9_%D1%82%D0%BE%D0%BF%D0%BB%D0%B8%D0%B2%D0%BD%D1%8B%D0%B9_%D1%84%D0%B8%D0%BB%D1%8C%D1%82%D1%80_geely_coolray_okavango_azkarra_%D0%BA%D0%BE%D0%BF%D0%B8%D1%8F_%D0%BA%D0%BE%D0%BF%D0%B8%D1%8F_%D0%BA%D0%BE%D0%BF%D0%B8%D1%8F_9_avfuii.png">

<style>
  :root{ --bg:#0a1c2b; --card:#0f1d2a; --muted:#9fb2c3; --text:#e9f0f7; --brand:#aa8643; --border:#1e3040; --chip:#122233; --chip-active:#16283a; --table-head:#112131; }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui, -apple-system, sans-serif; padding-bottom: 50px;}
  
  header{background:rgba(10,28,43,.95);border-bottom:1px solid var(--border);padding:16px 0;position:sticky;top:0;z-index:100}
  .wrap{max-width:1100px;margin:0 auto;padding:0 18px}
  .head-row{display:flex;align-items:center;justify-content:space-between}
  .back-link{color:var(--brand);text-decoration:none;font-weight:600}
  
  .controls{margin-top:15px; overflow-x: auto; padding-bottom: 5px;}
  .chips{display:flex;gap:10px;}
  .chip{padding:8px 16px;border-radius:20px;border:1px solid var(--border);background:var(--chip);color:#c3d7eb;cursor:pointer;white-space:nowrap;}
  .chip.active{background:var(--brand);color:#fff;border-color:var(--brand);}

  /* –¢–∞–±–ª–∏—Ü–∞ */
  .table-container{margin-top:20px;overflow-x:auto;border-radius:12px;border:1px solid var(--border);background:var(--card); box-shadow: 0 10px 30px rgba(0,0,0,0.3);}
  table{width:100%;border-collapse:collapse;min-width:800px;font-size:14px}
  th, td{padding:12px;text-align:center;border-bottom:1px solid var(--border)}
  th{background:var(--table-head);color:var(--brand);font-weight:600;cursor:pointer;transition:0.2s;}
  th:hover:not(:first-child){background:var(--brand);color:#fff;}
  th:first-child, td:first-child{text-align:left;position:sticky;left:0;background:var(--card);z-index:2;border-right: 1px solid var(--border);}
  
  .marker-z{color:var(--brand);font-weight:900;} 
  .marker-i{color:var(--muted);opacity:0.5}

  /* –ë–ª–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–ö–æ—Ä–∑–∏–Ω–∞ –¢–û) */
  #to-result { display: none; margin-top: 30px; animation: slideUp 0.3s ease-out; }
  @keyframes slideUp { from {opacity:0; transform:translateY(20px);} to {opacity:1; transform:translateY(0);} }
  
  .result-header { border-left: 4px solid var(--brand); padding-left: 15px; margin-bottom: 20px; }
  .result-header h2 { margin: 0; color: #fff; }
  .result-header p { margin: 5px 0 0; color: var(--muted); }

  .parts-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px; }
  
  /* –ö–∞—Ä—Ç–æ—á–∫–∞ —Ç–æ–≤–∞—Ä–∞ (–º–∏–Ω–∏) */
  .part-card { background: var(--card); border: 1px solid var(--border); border-radius: 8px; padding: 12px; display: flex; gap: 12px; align-items: center; }
  .part-img { width: 60px; height: 60px; object-fit: contain; background: #fff; border-radius: 4px; }
  .part-info h4 { margin: 0 0 4px; font-size: 14px; color: #fff; }
  .part-price { color: var(--brand); font-weight: bold; }
  .part-btn { display: inline-block; margin-top: 8px; padding: 6px 12px; background: var(--border); color: #fff; text-decoration: none; font-size: 12px; border-radius: 4px; }
  .part-btn:hover { background: var(--brand); }

  .empty-msg { color: var(--muted); font-style: italic; padding: 10px; border: 1px dashed var(--border); border-radius: 8px;}

  .selected-col { background: rgba(170, 134, 67, 0.1); border-left: 2px solid var(--brand); border-right: 2px solid var(--brand); }
</style>
</head>
<body>

<header>
  <div class="wrap">
    <div class="head-row">
      <h3 style="margin:0">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¢–û</h3>
      <a href="/" class="back-link">‚Üê –í –ö–∞—Ç–∞–ª–æ–≥</a>
    </div>
    <div class="controls">
      <div class="chips" id="modelChips"></div>
    </div>
  </div>
</header>

<main class="wrap">
  <div class="table-container" id="tableWrap"></div>

  <div id="to-result">
    <div class="result-header">
      <h2 id="res-title">–¢–û-2 (20 000 –∫–º)</h2>
      <p>–°–ø–∏—Å–æ–∫ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –∑–∞–º–µ–Ω –∏ –∑–∞–ø—á–∞—Å—Ç–µ–π –∏–∑ –Ω–∞—à–µ–≥–æ –∫–∞—Ç–∞–ª–æ–≥–∞:</p>
    </div>
    <div class="parts-grid" id="res-grid"></div>
  </div>
</main>

<script>
// 1. –î–ê–ù–ù–´–ï –†–ï–ì–õ–ê–ú–ï–ù–¢–ê (–ú–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å)
const DATA = {
  monjaro: {
    title: "Geely Monjaro",
    rows: [
      { name: "–ú–æ—Ç–æ—Ä–Ω–æ–µ –º–∞—Å–ª–æ", search: ["–º–∞—Å–ª–æ"], vals: ["–ó","–ó","–ó","–ó","–ó","–ó","–ó","–ó","–ó","–ó"] },
      { name: "–ú–∞—Å–ª—è–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä", search: ["–º–∞—Å–ª—è–Ω—ã–π"], vals: ["–ó","–ó","–ó","–ó","–ó","–ó","–ó","–ó","–ó","–ó"] },
      { name: "–í–æ–∑–¥—É—à–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä", search: ["–≤–æ–∑–¥—É—à–Ω—ã–π"], vals: ["–ò","–ó","–ò","–ó","–ò","–ó","–ò","–ó","–ò","–ó"] },
      { name: "–°–∞–ª–æ–Ω–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä", search: ["—Å–∞–ª–æ–Ω–Ω—ã–π"], vals: ["–ò","–ó","–ò","–ó","–ò","–ó","–ò","–ó","–ò","–ó"] },
      { name: "–°–≤–µ—á–∏ –∑–∞–∂–∏–≥–∞–Ω–∏—è", search: ["—Å–≤–µ—á–∏"], vals: ["-","-","-","–ó","-","-","-","–ó","-","-"] },
      { name: "–¢–æ—Ä–º–æ–∑–Ω–∞—è –∂–∏–¥–∫–æ—Å—Ç—å", search: ["—Ç–æ—Ä–º–æ–∑–Ω–∞—è"], vals: ["-","-","-","–ó","-","-","-","–ó","-","-"] },
      { name: "–¢–æ–ø–ª–∏–≤–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä", search: ["—Ç–æ–ø–ª–∏–≤–Ω—ã–π"], vals: ["-","-","–ó","-","-","–ó","-","-","–ó","-"] }
    ]
  },
  coolray: {
    title: "Geely Coolray",
    rows: [
      { name: "–ú–æ—Ç–æ—Ä–Ω–æ–µ –º–∞—Å–ª–æ", search: ["–º–∞—Å–ª–æ"], vals: ["–ó","–ó","–ó","–ó","–ó","–ó","–ó","–ó","–ó","–ó"] },
      { name: "–ú–∞—Å–ª—è–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä", search: ["–º–∞—Å–ª—è–Ω—ã–π"], vals: ["–ó","–ó","–ó","–ó","–ó","–ó","–ó","–ó","–ó","–ó"] },
      { name: "–í–æ–∑–¥—É—à–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä", search: ["–≤–æ–∑–¥—É—à–Ω—ã–π"], vals: ["–ò","–ó","–ò","–ó","–ò","–ó","–ò","–ó","–ò","–ó"] },
      { name: "–°–∞–ª–æ–Ω–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä", search: ["—Å–∞–ª–æ–Ω–Ω—ã–π"], vals: ["–ò","–ó","–ò","–ó","–ò","–ó","–ò","–ó","–ò","–ó"] },
      { name: "–°–≤–µ—á–∏ –∑–∞–∂–∏–≥–∞–Ω–∏—è", search: ["—Å–≤–µ—á–∏"], vals: ["-","-","-","–ó","-","-","-","–ó","-","-"] },
      { name: "–¢–æ–ø–ª–∏–≤–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä", search: ["—Ç–æ–ø–ª–∏–≤–Ω—ã–π"], vals: ["-","-","–ó","-","-","–ó","-","-","–ó","-"] }
    ]
  },
  okavango: {
    title: "Geely Okavango",
    rows: [
      { name: "–ú–æ—Ç–æ—Ä–Ω–æ–µ –º–∞—Å–ª–æ", search: ["–º–∞—Å–ª–æ"], vals: ["–ó","–ó","–ó","–ó","–ó","–ó","–ó","–ó","–ó","–ó"] },
      { name: "–§–∏–ª—å—Ç—Ä—ã (–ö–æ–º–ø–ª–µ–∫—Ç)", search: ["—Ñ–∏–ª—å—Ç—Ä"], vals: ["–ò","–ó","–ò","–ó","–ò","–ó","–ò","–ó","–ò","–ó"] },
      { name: "–°–≤–µ—á–∏ –∑–∞–∂–∏–≥–∞–Ω–∏—è", search: ["—Å–≤–µ—á–∏"], vals: ["-","-","-","–ó","-","-","-","–ó","-","-"] }
    ]
  },
  atlas: {
    title: "Geely Atlas",
    rows: [
      { name: "–ú–æ—Ç–æ—Ä–Ω–æ–µ –º–∞—Å–ª–æ", search: ["–º–∞—Å–ª–æ"], vals: ["–ó","–ó","–ó","–ó","–ó","–ó","–ó","–ó","–ó","–ó"] },
      { name: "–§–∏–ª—å—Ç—Ä—ã", search: ["—Ñ–∏–ª—å—Ç—Ä"], vals: ["–ò","–ó","–ò","–ó","–ò","–ó","–ò","–ó","–ò","–ó"] }
    ]
  }
};

const MODELS = [
  {id:'monjaro', label:'Monjaro'},
  {id:'coolray', label:'Coolray'},
  {id:'okavango', label:'Okavango'},
  {id:'atlas', label:'Atlas'},
];

let activeModel = 'monjaro';
let productsDB = []; // –°—é–¥–∞ –∑–∞–≥—Ä—É–∑–∏–º —Ç–æ–≤–∞—Ä—ã –∏–∑ JSON

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
const params = new URLSearchParams(window.location.search);
const modelFromUrl = params.get('model');
if(modelFromUrl && DATA[modelFromUrl]) activeModel = modelFromUrl;

init();

function init(){
  renderChips();
  loadProductsAndRender();
}

function setModel(id){
  activeModel = id;
  // –û–±–Ω–æ–≤–ª—è–µ–º URL –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
  const url = new URL(window.location);
  url.searchParams.set('model', id);
  window.history.pushState({}, '', url);
  
  renderChips();
  loadProductsAndRender();
  // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–æ—à–ª—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
  document.getElementById('to-result').style.display = 'none';
}

function renderChips(){
  document.getElementById('modelChips').innerHTML = MODELS.map(m => 
    `<div class="chip ${m.id === activeModel ? 'active' : ''}" 
          onclick="setModel('${m.id}')">${m.label}</div>`
  ).join('');
}

// 2. –ó–ê–ì–†–£–ó–ö–ê –¢–û–í–ê–†–û–í (–ú–∞–≥–∏—è)
async function loadProductsAndRender(){
  const tableWrap = document.getElementById('tableWrap');
  tableWrap.innerHTML = '<div style="padding:20px;text-align:center">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>';
  
  try {
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∞–π–ª –∑–∞–ø—á–∞—Å—Ç–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, monjaro.json)
    const resp = await fetch(`./${activeModel}.json`);
    const json = await resp.json();
    productsDB = json.items || [];
    renderTable();
  } catch(e) {
    tableWrap.innerHTML = '<div style="padding:20px;color:red">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–∞–ª–æ–≥–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª—ã.</div>';
    console.error(e);
  }
}

function renderTable(){
  const data = DATA[activeModel];
  const headers = Array.from({length:10}, (_,i) => (i+1)*10); // 10..100
  
  let html = `
    <table>
      <thead>
        <tr>
          <th>–£–∑–µ–ª / –ü—Ä–æ–±–µ–≥</th>
          ${headers.map((h, i) => 
            `<th onclick="showTO(${i}, ${h})">
               ${h} —Ç.–∫–º<br><span style="font-size:10px;font-weight:normal">–ù–∞–∂–º–∏</span>
             </th>`
          ).join('')}
        </tr>
      </thead>
      <tbody>
        ${data.rows.map(row => `
          <tr>
            <td>${row.name}</td>
            ${row.vals.map((v, idx) => {
              let cls = v === '–ó' ? 'marker-z' : (v === '–ò' ? 'marker-i' : '');
              return `<td class="${cls}" id="cell-${idx}">${v}</td>`;
            }).join('')}
          </tr>
        `).join('')}
      </tbody>
    </table>
  `;
  document.getElementById('tableWrap').innerHTML = html;
}

// 3. –ü–û–ö–ê–ó –†–ï–ó–£–õ–¨–¢–ê–¢–û–í (–ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Å—Ç–æ–ª–±–µ—Ü)
window.showTO = function(colIndex, km){
  const data = DATA[activeModel];
  const resBlock = document.getElementById('to-result');
  const resGrid = document.getElementById('res-grid');
  
  // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Å—Ç–æ–ª–±—Ü–∞ (–≤–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç)
  document.querySelectorAll('td').forEach(td => td.classList.remove('selected-col'));
  // –≠—Ç–æ —Å–ª–æ–∂–Ω–µ–µ —Å–¥–µ–ª–∞—Ç—å –±–µ–∑ –∫–ª–∞—Å—Å–æ–≤ –Ω–∞ —è—á–µ–π–∫–∞—Ö, –æ–ø—É—Å—Ç–∏–º –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –∏–ª–∏ –¥–æ–±–∞–≤–∏–º –∫–ª–∞—Å—Å—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏,
  // –Ω–æ –≥–ª–∞–≤–Ω–æ–µ - –ø–æ–∫–∞–∑–∞—Ç—å —Ç–æ–≤–∞—Ä—ã.

  resBlock.style.display = 'block';
  document.getElementById('res-title').innerText = `–¢–û –Ω–∞ ${km} 000 –∫–º`;
  resGrid.innerHTML = '';

  // –°–æ–±–∏—Ä–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ç–æ–≥–æ, —á—Ç–æ –Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å
  const needsReplace = data.rows.filter(r => r.vals[colIndex] === '–ó');

  if(needsReplace.length === 0){
    resGrid.innerHTML = '<div class="empty-msg">–î–ª—è —ç—Ç–æ–≥–æ –ø—Ä–æ–±–µ–≥–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–º–µ–Ω –ø–æ —Ä–µ–≥–ª–∞–º–µ–Ω—Ç—É –Ω–µ—Ç (—Ç–æ–ª—å–∫–æ –æ—Å–º–æ—Ç—Ä).</div>';
    resBlock.scrollIntoView({behavior: "smooth"});
    return;
  }

  // –î–ª—è –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏ –∏—â–µ–º —Ç–æ–≤–∞—Ä—ã –≤ productsDB
  needsReplace.forEach(req => {
    // –ò—â–µ–º —Ç–æ–≤–∞—Ä—ã, –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ –∫–æ—Ç–æ—Ä—ã—Ö –µ—Å—Ç—å –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ (search)
    // –ù–∞–ø—Ä–∏–º–µ—Ä search: ["—Ñ–∏–ª—å—Ç—Ä", "–º–∞—Å–ª—è–Ω—ã–π"]
    // –¢–æ–≤–∞—Ä: "–ú–∞—Å–ª—è–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä Geely..."
    
    // –ü—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞: –∏—â–µ–º –ª—é–±–æ–π —Ç–æ–≤–∞—Ä, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ –∏–∑ —Å–ø–∏—Å–∫–∞
    const foundParts = productsDB.filter(p => {
      const pName = p.name.toLowerCase();
      // –ï—Å–ª–∏ –µ—Å—Ç—å –ø–æ–ª–µ search –≤ —Ä–µ–≥–ª–∞–º–µ–Ω—Ç–µ, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ, –∏–Ω–∞—á–µ –∏—â–µ–º –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é —Å—Ç—Ä–æ–∫–∏
      const keywords = req.search || [req.name.toLowerCase()];
      return keywords.some(k => pName.includes(k));
    });

    // –†–∏—Å—É–µ–º –±–ª–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    const catBlock = document.createElement('div');
    catBlock.style.gridColumn = "1 / -1";
    catBlock.style.marginTop = "10px";
    catBlock.innerHTML = `<strong style="color:var(--brand)">üëâ ${req.name}:</strong>`;
    resGrid.appendChild(catBlock);

    if(foundParts.length > 0){
      foundParts.forEach(p => {
        const card = document.createElement('div');
        card.className = 'part-card';
        card.innerHTML = `
          <img src="${p.img}" class="part-img" onerror="this.src='https://via.placeholder.com/60'">
          <div class="part-info">
            <h4>${p.name}</h4>
            <div class="part-price">${p.price} ‚Ç∏</div>
            <a href="${p.kaspi || '#'}" target="_blank" class="part-btn">–ö—É–ø–∏—Ç—å</a>
          </div>
        `;
        resGrid.appendChild(card);
      });
    } else {
      const msg = document.createElement('div');
      msg.className = 'empty-msg';
      msg.innerText = '–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ –∫–∞—Ç–∞–ª–æ–≥–µ, —É—Ç–æ—á–Ω–∏—Ç–µ —É –º–µ–Ω–µ–¥–∂–µ—Ä–∞.';
      resGrid.appendChild(msg);
    }
  });

  // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º
  setTimeout(() => resBlock.scrollIntoView({behavior: "smooth"}), 100);
}
</script>

</body>
</html>
